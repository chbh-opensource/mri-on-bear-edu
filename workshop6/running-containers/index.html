
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://chbh-opensource.github.io/mri-on-bear-edu/workshop6/running-containers/">
      
      
        <link rel="prev" href="../workshop6-intro/">
      
      
        <link rel="next" href="../../workshop7/workshop7-intro/">
      
      
      <link rel="icon" href="../../assets/images/chbh_logo.jpg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Scripting analyses, running jobs on the cluster and working with containers - MRI on BEAR</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=SF+Pro+Display:300,300i,400,400i,700,700i%7CSF+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"SF Pro Display";--md-code-font:"SF Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#scripting-analyses-submitting-jobs-on-the-cluster-and-running-containers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MRI on BEAR" class="md-header__button md-logo" aria-label="MRI on BEAR" data-md-component="logo">
      
  <img src="../../assets/images/chbh_logo.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MRI on BEAR
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Scripting analyses, running jobs on the cluster and working with containers
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/chbh-opensource/mri-on-bear-edu" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    MRI-on-BEAR
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
<nav class="md-nav md-nav--primary" aria-label="nav.title">
  <div class="md-nav__logo">
    <img src="../../assets/images/chbh_logo.jpg" alt="MRI on BEAR">
  </div>
  
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MRI on BEAR" class="md-nav__button md-logo" aria-label="MRI on BEAR" data-md-component="logo">
      
  <img src="../../assets/images/chbh_logo.jpg" alt="logo">

    </a>
    MRI on BEAR
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/chbh-opensource/mri-on-bear-edu" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    MRI-on-BEAR
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setting-up/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accessing BlueBEAR and the BEAR Portal
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workshop 1 - Introduction to BlueBEAR and Linux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Workshop 1 - Introduction to BlueBEAR and Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop1/workshop1-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workshop 1 - Aims and objectives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop1/intro-to-bluebear/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to the BlueBEAR Portal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop1/intro-to-linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Linux
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workshop 2 - Basic MRI skills
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Workshop 2 - Basic MRI skills
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop2/workshop2-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workshop 2 - Aims and objectives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop2/mri-data-formats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with MRI Data - Files and Formats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop2/visualizing-mri-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MRI data visualization with FSLeyes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workshop 3 - Basic diffusion MRI analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Workshop 3 - Basic diffusion MRI analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop3/workshop3-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workshop 3 - Aims and objectives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop3/diffusion-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diffusion MRI basics - visualization and preprocessing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop3/diffusion-mri-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diffusion tensor fitting and Tract-Based Spatial Statistics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workshop 4 - Advanced diffusion MRI analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Workshop 4 - Advanced diffusion MRI analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop4/workshop4-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workshop 4 - Aims and objectives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop4/probabilistic-tractography/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Probabilistic tractography
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workshop 5 - First-level fMRI analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Workshop 5 - First-level fMRI analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop5/workshop5-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workshop 5 - Aims and objectives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop5/preprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting brain extraction with BET
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop5/first-level-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running the first-level analysis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workshop 6 - Scripts, containers and running jobs on the cluster
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Workshop 6 - Scripts, containers and running jobs on the cluster
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshop6-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workshop 6 - Aims and objectives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Scripting analyses, running jobs on the cluster and working with containers
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Scripting analyses, running jobs on the cluster and working with containers
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-to-scripting" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to scripting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submitting-jobs-to-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Submitting jobs to the cluster
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers" class="md-nav__link">
    <span class="md-ellipsis">
      Containers
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workshop 7 - Higher-level fMRI analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Workshop 7 - Higher-level fMRI analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop7/workshop7-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workshop 7 - Aims and objectives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop7/higher-level-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running the higher-level analysis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workshop 8 - Functional connectivity
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Workshop 8 - Functional connectivity
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop8/functional-connectivity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Functional connectivity analysis of resting-state fMRI data using FSL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Additional Resources
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributors
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
</nav>

          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                

                  

  
  


<h1 id="scripting-analyses-submitting-jobs-on-the-cluster-and-running-containers">Scripting analyses, submitting jobs on the cluster, and running containers<a class="headerlink" href="#scripting-analyses-submitting-jobs-on-the-cluster-and-running-containers" title="Permanent link">&para;</a></h1>
<h2 id="introduction-to-scripting">Introduction to scripting<a class="headerlink" href="#introduction-to-scripting" title="Permanent link">&para;</a></h2>
<p>Script files are text files that contain Linux command-line instructions that are equivalent to typing a series of commands in the terminal or the equivalent using the software GUI (e.g., FSL GUI). <b>By scripting, it is possible to automate most of the FSL processing, including both diffusion MRI and fMRI analysis.</b> In the previous workshop you were learning how to set up a first level fMRI model for a single experimental run for one participant. Subsequently, in your own time, you were asked to repeat that process for other participants (15 participants in total), some participants with 2 or 3 experimental runs. </p>
<p>The notes below provide a basic introduction to Linux (bash) scripting as well as some guidelines and examples on how to automate the first-level analysis as you might want to do when completing the Data Analysis assignment.</p>
<p>To do this, we have provided some basic info and script examples. You can use the examples when analysing the remaining participants' data (the task you were given to complete at the end of the previous workshop) if you have not done it already. If you have already done so, you can either repeat that process by scripting, or apply it to your assessment. But you can also complete all these tasks without scripting. </p>
<p>All the example scripts shown below are in the folder:</p>
<div class="codehilite"><pre><span></span><code>/rds/projects/c/chechlmy-chbh-mricn/module_data/scripts
</code></pre></div>

<p align="center">
 <img src="../../assets/images/workshop6/scripts_folder.png" alt="Scripts Folder" width="700" height="300">
</p>

<p>To start please copy the entire folder into your module directory. <b>Please note that to run some of the scripts as per examples below, you will need to load FSL, something you should know how to do.</b></p>
<p>A script can be very simple, containing just commands that you already know how to use, with each command put on a separate line. To create a script for automating FSL analysis, the most widely used language is <code>bash</code> (<code>shell</code>). To write a <code>bash</code> script you need a plain text editor (e.g., vim, nano). If you are not familiar with using a text editor in Linux terminal, there is a simple way of creating and/or editing scripts using the BlueBEAR portal.</p>
<p>You can start a new script by clicking on “New File” and naming it for example “<code>my_script.sh</code>” and next clicking on “Edit” to start typing commands you want to use. You can also use “Edit” to edit existing scripts. </p>
<p align="center">
 <img src="../../assets/images/workshop6/edit_scripts.png" alt="Edit Scripts" width="900" height="300">
</p>

<div class="admonition tip">
<p class="admonition-title">The shebang</p>
<p>The first line of every <code>bash</code> script should be <code>#!/bin/bash</code>. This is the 'shebang' or 'hashbang' line. It tells the system which interpreter should be used to execute the script.</p>
</div>
<p>Suppose we want to create a very simple script repeatedly using one of the FSL command line tools. Let's say that we want to find out what is the volume for each of the T1 brains in our experiment. The FSL command that will tell us this is <code>fslstats</code>, together with the <code>-V</code> option which lists the number and volume of non-empty voxels. </p>
<p>To create this script, you would type the text below as in the provided <code>brainvols.sh</code> script example. To view it, select this script and click on 'Edit'. Alternatively, you can start a new file and copy the commands as shown below. (In the actual script you would need to replace <code>xxx</code> with the name of your own directory).</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nb">cd</span><span class="w"> </span>rds/projects/c/chechlmy-chbh-mricn/xxx/recon
fslstats<span class="w"> </span>p01/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p02/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p03/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p04/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p05/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p06/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p07/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p08/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p09/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p10/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p11/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p12/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p13/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p14/T1_brain<span class="w"> </span>-V
fslstats<span class="w"> </span>p15/T1_brain<span class="w"> </span>-V
</code></pre></div>

<p>Whether you are editing or creating a new script, you need to save it. After saving, exit the editor. </p>
<p>Next you need to make the script executable (as below) and remember the script will run in the current directory (<code>pwd</code>). You also need to make the script executable if you copied a script from someone else.</p>
<p>To make your script executable type in terminal: <code>chmod a+x brainvols.sh</code></p>
<div class="admonition warning">
<p class="admonition-title">Running the script without permissions</p>
<p>If you try to run the script without making it executable, you will get a permission error. </p>
</div>
<p>To run the script, type in your terminal <code>./brainvols.sh</code></p>
<p>You can now tell which participant has the biggest brain.</p>
<p>The previous script hopefully worked. But it is not very elegant and is not much of an improvement over typing the commands one at a time in a terminal window. <b>However, the <code>bash</code> scripting language that we are using provides an extra layer of simple program commands that we can use in combination with the FSL commands we want to run.</b> In this way we can make our scripts more efficient:</p>
<ul>
<li>
<p>In the <code>brainvols.sh</code> script above it would be better to replace the above <code>fslstats</code> lines of code – which basically do the same thing but with a different participant – with a loop of some kind. </p>
</li>
<li>
<p>Also, it would be helpful to print out some text so that we know which line of output on the screen relates to which participant. </p>
</li>
</ul>
<p>Bash has a <code>for … do ... done</code> construct to do the former and an <code>echo</code> command to do the latter. So, let's use these to create an improved script with a loop. This is illustrated in the example <code>brainvols2.sh</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nb">cd</span><span class="w"> </span>rds/projects/c/chechlmy-chbh-mricn/xxx/recon
<span class="k">for</span><span class="w"> </span>p<span class="w"> </span><span class="k">in</span><span class="w"> </span>p01<span class="w"> </span>p02<span class="w"> </span>p03<span class="w"> </span>p04<span class="w"> </span>p05<span class="w"> </span>p06<span class="w"> </span>p07<span class="w"> </span>p08<span class="w"> </span>p09<span class="w"> </span>p10<span class="w"> </span>p11<span class="w"> </span>p12<span class="w"> </span>p13<span class="w"> </span>p14<span class="w"> </span>p15
<span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;Participant </span><span class="si">${</span><span class="nv">p</span><span class="si">}</span><span class="s2">: &quot;</span>
<span class="w">    </span>fslstats<span class="w"> </span><span class="si">${</span><span class="nv">p</span><span class="si">}</span>/T1_brain<span class="w"> </span>-V
<span class="k">done</span>
</code></pre></div>

<p>Both examples above assume that you have already run BET (brain extraction) on T1 scans. But of course, you could also automate the process of brain extraction and complete both tasks, i.e., running bet and calculate volume, using a single script. This is illustrated in the example <code>bet_brainvols.sh</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># navigate to the folder containing the T1 scans</span>
<span class="nb">cd</span><span class="w"> </span>rds/projects/c/chechlmy-chbh-mricn/xxx/recon

<span class="c1"># a for loop over participant data files</span>
<span class="k">for</span><span class="w"> </span>participant_num<span class="w"> </span><span class="k">in</span><span class="w"> </span>p01<span class="w"> </span>p02<span class="w"> </span>p03<span class="w"> </span>p04<span class="w"> </span>p05<span class="w"> </span>p06<span class="w"> </span>p07<span class="w"> </span>p08<span class="w"> </span>p09<span class="w"> </span>p10<span class="w"> </span>p11<span class="w"> </span>p12<span class="w"> </span>p13<span class="w"> </span>p14<span class="w"> </span>p15

<span class="c1"># do the following ...</span>
<span class="k">do</span>
<span class="w">    </span><span class="c1"># show the participant number </span>
<span class="w">    </span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;Participant </span><span class="si">${</span><span class="nv">participant_num</span><span class="si">}</span><span class="s2">: \n&quot;</span>

<span class="w">    </span><span class="c1"># delete the old extracted brain image (we can see this</span>
<span class="w">    </span><span class="c1"># happen in real time in the file explorer)</span>
<span class="w">    </span>rm<span class="w"> </span><span class="si">${</span><span class="nv">participant_num</span><span class="si">}</span>/T1_brain.nii.gz

<span class="w">    </span><span class="c1"># extract the brain from the T1 image</span>
<span class="w">    </span>bet<span class="w"> </span><span class="si">${</span><span class="nv">participant_num</span><span class="si">}</span>/T1.nii.gz<span class="w"> </span><span class="si">${</span><span class="nv">participant_num</span><span class="si">}</span>/T1_brain

<span class="w">    </span><span class="c1"># list the number of non-empty brain voxels</span>
<span class="w">    </span>fslstats<span class="w"> </span><span class="si">${</span><span class="nv">participant_num</span><span class="si">}</span>/T1_brain<span class="w"> </span>-V
<span class="c1"># end the loop</span>
<span class="k">done</span>

<span class="c1"># ============================================================</span>
<span class="c1"># END OF SCRIPT</span>
</code></pre></div>

<p>Some of the most powerful scripting comes when manipulating FEAT model files. <b>When you create a design for a first level fMRI analysis in the FEAT GUI and press the 'Go' button, FEAT writes out the model analysis file into the output directory.</b> The name for this saved file is <code>design.fsf</code>. Once you have created one of these files, you can load it back into FEAT and modify only the parts that are different between the different analyses and then resave it e.g., change parameters or change it for another participant (see workshop materials covering first level of fMRI analysis).</p>
<p><b>Alternatively, since <code>design.fsf</code> is a text file it can also be opened (and edited) in a text editor.</b> Because the experiment – and therefore the model design – is almost the same for all participants, there is very little difference in the <code>design.fsf</code> files between the level one analyses for different participants. In fact, if following the directory structure naming convention suggested in the workshop, the only thing that changes for a particular run is the identifier of the participant. </p>
<p>So, if we copy the design file for <code>p01</code>'s first scan (i.e. the file <code>feat/1/p01_s1.feat/design.fsf</code>), open it up in a text editor, search and replace every instance of <code>p01</code> with <code>p02</code> and then save it, we should have the model file for <code>p02</code>'s first scan. The only differences should be in:</p>
<ul>
<li>
<p>The 4d input EPI file: <code>/recon/p01/fmri1</code> → /recon/p02/fmri1</p>
</li>
<li>
<p>The output directory: <code>/feat/1/p02_s1</code> → <code>/feat/1/p02_s1</code></p>
</li>
<li>
<p>The registration: <code>/recon/p01/T1_brain</code> → <code>/recon/p02/T1_brain</code></p>
</li>
</ul>
<p>In general, all the model files will only differ by the participant identifiers (<code>p01-p15</code>) the identifiers we've used for the particular scan number (<code>s1</code>, <code>s2</code> and <code>s3</code> for output directories, and <code>fmri1</code>, <code>fmri2</code> and <code>fmri3</code> in the input EPI file names). </p>
<p>The special cases are the scans for the first two participants. These scans were only 93 volumes long, whereas all the rest of the scans following this are 94 volumes long. <b>However, given the above information and the model file for participant 1, scan 1, we can now create a script that will generate all other model files.</b> </p>
<p>Firstly, let's create a new directory (<code>models</code>) where you will keep your model files. Navigate to your folder (<code>/rds/projects/c/chechlmy-chbh-mricn/xxx/</code>) and type:</p>
<p><code>mkdir models</code></p>
<p>Now copy the script <code>create_alldesignmodels.sh</code> into that folder. The script contains the following code:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Copy over the saved model file for p01 scan 1</span>
cp<span class="w"> </span>/rds/projects/c/chechlmy-chbh-mricn/xxx/feat/1/p01_s1.feat/design.fsf<span class="w"> </span>p01_s1.fsf

<span class="c1"># Create model file for p02 scan1</span>
cp<span class="w"> </span>p01_s1.fsf<span class="w"> </span>p02_s1.fsf
perl<span class="w"> </span>-i<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/p01/p02/&#39;</span><span class="w"> </span>p02_s1.fsf

<span class="c1"># Create model files for p03-p15 scan 1</span>
<span class="k">for</span><span class="w"> </span>p<span class="w"> </span><span class="k">in</span><span class="w"> </span>p03<span class="w"> </span>p04<span class="w"> </span>p05<span class="w"> </span>p06<span class="w"> </span>p07<span class="w"> </span>p08<span class="w"> </span>p09<span class="w"> </span>p10<span class="w"> </span>p11<span class="w"> </span>p12<span class="w"> </span>p13<span class="w"> </span>p14<span class="w"> </span>p15
<span class="k">do</span>
<span class="w">    </span>cp<span class="w"> </span>p01_s1.fsf<span class="w"> </span><span class="si">${</span><span class="nv">p</span><span class="si">}</span>_s1.fsf
<span class="w">    </span>perl<span class="w"> </span>-i<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/p01/</span><span class="si">${</span><span class="nv">p</span><span class="si">}</span><span class="s2">/&quot;</span><span class="w"> </span><span class="si">${</span><span class="nv">p</span><span class="si">}</span>_s1.fsf
<span class="w">    </span>perl<span class="w"> </span>-i<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/93/94/&#39;</span><span class="w"> </span><span class="si">${</span><span class="nv">p</span><span class="si">}</span>_s1.fsf
<span class="k">done</span>

<span class="c1"># Create model files for p03-p15 scan 2</span>
<span class="k">for</span><span class="w"> </span>p<span class="w"> </span><span class="k">in</span><span class="w"> </span>p03<span class="w"> </span>p04<span class="w"> </span>p05<span class="w"> </span>p06<span class="w"> </span>p07<span class="w"> </span>p08<span class="w"> </span>p09<span class="w"> </span>p10<span class="w"> </span>p11<span class="w"> </span>p12<span class="w"> </span>p13<span class="w"> </span>p14<span class="w"> </span>p15
<span class="k">do</span>
<span class="w">    </span>cp<span class="w"> </span><span class="si">${</span><span class="nv">p</span><span class="si">}</span>_s1.fsf<span class="w"> </span><span class="si">${</span><span class="nv">p</span><span class="si">}</span>_s2.fsf
<span class="w">    </span>perl<span class="w"> </span>-i<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/_s1/_s2/&#39;</span><span class="w"> </span><span class="si">${</span><span class="nv">p</span><span class="si">}</span>_s2.fsf
<span class="w">    </span>perl<span class="w"> </span>-i<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/fmri1/fmri2/&#39;</span><span class="w"> </span><span class="si">${</span><span class="nv">p</span><span class="si">}</span>_s2.fsf
<span class="k">done</span>

<span class="c1"># Create model files for p05 scan 3</span>
cp<span class="w"> </span>p05_s1.fsf<span class="w"> </span>p05_s3.fsf
perl<span class="w"> </span>-i<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/_s1/_s3/&#39;</span><span class="w"> </span>p05_s3.fsf
perl<span class="w"> </span>-i<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/fmri1/fmri3/&#39;</span><span class="w"> </span>p05_s3.fsf
</code></pre></div>

<p>Edit (hint: replace the <code>xxx</code>), and save the file, make it executable, and then run it. </p>
<p>If it has worked you should now have a directory full of model files. Each of them can be run from the command line with a command such as <code>feat p01_s1.fsf</code> or with a script (you should be able to create such script using the earlier example).</p>
<div class="admonition tip">
<p class="admonition-title">FSL's scripting tutorial</p>
<p>You can find more information and other examples on <a href="https://open.win.ox.ac.uk/pages/fslcourse/lectures/scripting/">FSL's scripting tutorial</a> webpage.</p>
</div>
<h2 id="submitting-jobs-to-the-cluster">Submitting jobs to the cluster<a class="headerlink" href="#submitting-jobs-to-the-cluster" title="Permanent link">&para;</a></h2>
<p>The first part of this workshop introduced you to running <code>bash</code> scripts using the terminal in the BlueBEAR GUI. However, in addition to running <code>bash</code> scripts in this way, you can also create scripts and run analysis jobs directly on the cluster with Slurm (BlueBEAR's high performance computing (HPC) scheduling system). </p>
<div class="admonition info">
<p class="admonition-title">What is Slurm?</p>
<p>Understanding how Slurm works is beyond the scope of this course, and is not strictly necessary, but you can find out more by reading the official Slurm <a href="https://slurm.schedmd.com/documentation.html">documentation</a>.</p>
</div>
<p>In previous workshops we were using BlueBEAR Portal to launch BlueBEAR GUI Linux desktop and from there the built-in terminal. As mentioned in workshop 1, you can also use BlueBEAR Portal to jump directly on BlueBEAR terminal, to access one of the available login nodes and from there, run analysis jobs. </p>
<p align="center">
 <img src="../../assets/images/workshop6/bluebear_hpc_tab.png" alt="Brainvols" width="700" height="300">
</p>

<p>While the BEAR Portal provides a convenient web-based access to a range of BlueBEAR services, you don’t have to go via this portal, but can instead use the command line to access BlueBEAR through one of the multiple login nodes, available from the address <a href="http://bluebear.bham.ac.uk/">bluebear.bham.ac.uk</a>.</p>
<p>Exactly how you do that will depend on the type of the operating system your computer uses; you can find detailed information about Accessing BlueBEAR using the command line from <a href="https://docs.bear.bham.ac.uk/bluebear/accessing/">this link</a>.</p>
<p>The process of submitting and running jobs on the cluster is exactly the same whether using the BlueBEAR terminal via the “Clusters” tab on the BlueBEAR portal or using the command line. To run a job with Slurm (BlueBEAR HPC scheduling system) you first need to prepare a job script and then submit using the command <code>sbatch</code>.</p>
<p>In the first part of this workshop you have learned how to create <code>bash</code> scripts to automate FSL analyses; in order to turn these scripts into the job script for Slurm, you need to add a few additional command lines. This is illustrated in the example below: <code>bet_brainvols_job.sh</code></p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --qos=bbdefault</span>
<span class="c1">#SBATCH --time=60</span>
<span class="c1">#SBATCH --ntasks=5</span>

module<span class="w"> </span>purge<span class="p">;</span><span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>bluebear
module<span class="w"> </span>load<span class="w"> </span>FSL/6.0.5.1-foss-2021a

<span class="nb">set</span><span class="w"> </span>-e

<span class="c1"># navigate to the folder containing the T1 scans</span>
<span class="nb">cd</span><span class="w"> </span>rds/projects/c/chechlmy-chbh-mricn/xxx/recon

<span class="c1"># a for loop over participant data files</span>
<span class="k">for</span><span class="w"> </span>participant_num<span class="w"> </span><span class="k">in</span><span class="w"> </span>p01<span class="w"> </span>p02<span class="w"> </span>p03<span class="w"> </span>p04<span class="w"> </span>p05<span class="w"> </span>p06<span class="w"> </span>p07<span class="w"> </span>p08<span class="w"> </span>p09<span class="w"> </span>p10<span class="w"> </span>p11<span class="w"> </span>p12<span class="w"> </span>p13<span class="w"> </span>p14<span class="w"> </span>p15
<span class="k">do</span>
<span class="w">    </span><span class="c1"># do the following...</span>

<span class="w">    </span><span class="c1"># show the participant number</span>
<span class="w">    </span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;Participant </span><span class="si">${</span><span class="nv">participant_num</span><span class="si">}</span><span class="s2">: \n&quot;</span>

<span class="w">    </span><span class="c1"># delete the old extracted brain image (we can see this</span>
<span class="w">    </span><span class="c1"># happen in real time in the file explorer)</span>
<span class="w">    </span>rm<span class="w"> </span><span class="si">${</span><span class="nv">participant_num</span><span class="si">}</span>/T1_brain.nii.gz

<span class="w">    </span><span class="c1"># extract the brain from the T1 image</span>
<span class="w">    </span>bet<span class="w"> </span><span class="si">${</span><span class="nv">participant_num</span><span class="si">}</span>/T1.nii.gz<span class="w"> </span><span class="si">${</span><span class="nv">participant_num</span><span class="si">}</span>/T1_brain

<span class="w">    </span><span class="c1"># list the number of non-empty brain voxels</span>
<span class="w">    </span>fslstats<span class="w"> </span><span class="si">${</span><span class="nv">participant_num</span><span class="si">}</span>/T1_brain<span class="w"> </span>-V

<span class="c1"># end the loop</span>
<span class="k">done</span>

<span class="c1"># ============================================================</span>
<span class="c1"># END OF SCRIPT</span>
</code></pre></div>

<p>This is a modified version of the <code>bet_brainvols.sh script</code>. If you compare the two, you will notice that after the <code>#!/bin/bash</code> line and before the start of the script loop, a few new lines have been added. <b>These define the BlueBEAR resources required to complete the analysis job.</b> </p>
<p>These are explained below:</p>
<ul>
<li><code>#SBATCH –qos=bbdefault</code> defines set of resources required, here default option)</li>
<li><code>#SBATCH –time=60</code> sets the run time</li>
<li><code>#SBATCH –ntasks=5</code> runs the job with five cores; by default, the amount of memory (RAM) that a job is allocated is (the <code>--ntasks</code> value) x 4096MB.</li>
<li><code>module purge; module load bluebear</code> resets the environment to ensure that the script hasn’t inherited anything from where it was submitted. This line is required and slurm will reject the script if it isn’t present – it must be included before any other <code>module load</code> statements.</li>
<li><code>module load FSL/6.0.5.1-foss-2021a</code> loads FSL</li>
<li><code>set -e</code> - makes the script fail on first error </li>
</ul>
<p>The task of setting up resources is not always straightforward and will often require several test and error trials as if you do not request sufficient resources and time, your job might fail and if you request too many resources, it might be either rejected or be put in a long queue till require resources become available.</p>
<p>You can find detailed guidelines re specifying required resources in the <a href="https://docs.bear.bham.ac.uk/bluebear/jobs/">BlueBEAR documentation</a>.</p>
<p>The script above can be run on the cluster using the BlueBEAR terminal or the command line. To do the latter, you need to use the <code>sbatch</code> command which submits your job to the BlueBEAR scheduling system based on the requested resources. Once submitted it will run on the first available node(s) providing the resources you requested in your script. </p>
<p>For example, to submit your BET job as in the example script above, in the BlueBEAR terminal you would type:</p>
<p><code>sbatch bet_brainvols_job.sh</code></p>
<p>The system will return a job number, for example:</p>
<p><code>Submitted batch job XXXXXX</code></p>
<p><b>You need this number to monitor or cancel your job.</b></p>
<p>To monitor your job, you can use the <code>squeue</code> command by typing in the terminal:</p>
<p><code>squeue -j XXXXXX</code></p>
<p>This is a command for viewing the status of your jobs. It will display information including the job’s ID and name, the user that submitted the job, time elapsed and the number of nodes being used.</p>
<p>To cancel a queued or running job, you can use the <code>scancel</code> command by typing in the terminal:</p>
<p><code>scancel XXXXXX</code></p>
<h2 id="containers">Containers<a class="headerlink" href="#containers" title="Permanent link">&para;</a></h2>
<p>In previous workshops we have been using different pre-installed versions of FSL through different modules available on BEAR apps. Sometimes however, you might need a different (older or newer) version of FSL or a differently pre-compiled FSL. While you can request an up-to-date version of FSL - following the new release of the software it is added to BEAR apps (although it might take a while) - you cannot request to change how FSL is compiled on BEAR apps, as it would affect other BlueBEAR users or might not even be possible due to the BlueBEAR set up. </p>
<p><b>Instead, you can install FSL within a controlled container and use this contained version instead of what’s available on BEAR apps. </b></p>
<p><b>BlueBEAR supports containerisation using Apptainer.</b> Each BlueBEAR node has Apptainer installed, which means that the <code>apptainer</code> command is available without needing to first load a module. Apptainer can download images from any openly available container repository, for example Docker Hub or Neurodesk. Such sites will provide information re available software, software version and how to download a specific container.  </p>
<div class="admonition warning">
<p class="admonition-title">Downloading containers</p>
<p>Please do try to download any containers in this workshop!</p>
</div>
<p>In the folder <code>scripts</code>, which you copied at the start of this workshop, you will find the subdirectory <code>containers</code> with two FSL containers (two different versions of FSL) downloaded from <a href="https://www.neurodesk.org/">Neurodesk</a>:</p>
<p><code>/rds/projects/c/chechlmy-chbh-mricn/module_data/scripts/containers</code></p>
<p>The simplest way to use a container would be to load it and then use specific commands to run various FSL tools e.g., <code>bet</code>.</p>
<p>For example, you would type in your terminal:  </p>
<div class="codehilite"><pre><span></span><code>apptainer<span class="w"> </span>shell<span class="w"> </span>fsl_6.0.7.4_20231005.sing
bet<span class="w"> </span>T1.nii.gz<span class="w"> </span>T1_brain.nii.gz
</code></pre></div>

<p>You could also use a container in your job script to replace the BEAR apps version of FSL with the FSL container. To do that, you would need to add the line below to your script:</p>
<p><code>apptainer exec [name of the container]</code></p>
<p>Below is a very simple example of such a script, <code>example_job_fslcontainer.sh</code> which you can find inside the subdirectory <code>containers</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --qos=bbdefault</span>
<span class="c1">#SBATCH --time=30</span>
<span class="c1">#SBATCH --ntasks=5</span>

module<span class="w"> </span>purge<span class="p">;</span><span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>bluebear

<span class="nb">set</span><span class="w"> </span>-e

apptainer<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>fsl_6.0.7.4_20231005.sing<span class="w"> </span>bet<span class="w"> </span>T1.nii.gz<span class="w"> </span>T1_brain.nii.gz
</code></pre></div>












                


    <nav class="md-footer-nav md-grid" aria-label="Footer">
      <div class="md-footer-nav__inner">
        
          <a href="../workshop6-intro/" class="md-footer-nav__link md-footer-nav__link--prev">
            <span class="md-footer-nav__direction">
              Previous
            </span>
            <div class="md-footer-nav__title">
              Workshop 6 - Aims and objectives
            </div>
          </a>
        
        
          <a href="../../workshop7/workshop7-intro/" class="md-footer-nav__link md-footer-nav__link--next">
            <span class="md-footer-nav__direction">
              Next
            </span>
            <div class="md-footer-nav__title">
              Workshop 7 - Aims and objectives
            </div>
          </a>
        
      </div>
    </nav>



              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/chbh-on-bear" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/TheCHBH" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://gitlab.com/ajquinn" target="_blank" rel="noopener" title="gitlab.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81s-5.7.083-8.4 1.11c-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.1 18.1 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>